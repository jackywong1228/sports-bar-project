<view class="container">
  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <scroll-view class="category-tabs" scroll-x enable-flex>
    <view
      class="tab-item {{currentCategory === item.key ? 'active' : ''}}"
      wx:for="{{categories}}"
      wx:key="key"
      data-key="{{item.key}}"
      bindtap="switchCategory"
    >
      {{item.name}}
    </view>
  </scroll-view>

  <!-- ç»„é˜Ÿåˆ—è¡¨ -->
  <view class="team-list">
    <view class="team-item" wx:for="{{teams}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}">
      <view class="team-header">
        <view class="sport-badge {{item.sport_type}}">{{item.sport_type_name}}</view>
        <view class="team-status {{item.status}}">
          <text wx:if="{{item.status === 'recruiting'}}">æ‹›å‹Ÿä¸­</text>
          <text wx:elif="{{item.status === 'full'}}">å·²æ»¡å‘˜</text>
          <text wx:elif="{{item.status === 'completed'}}">å·²å®Œæˆ</text>
          <text wx:else>å·²å–æ¶ˆ</text>
        </view>
      </view>
      <view class="team-title">{{item.title}}</view>
      <view class="team-meta">
        <view class="meta-item">
          <text class="meta-icon">ğŸ“…</text>
          <text>{{item.activity_date}} {{item.activity_time}}</text>
        </view>
        <view class="meta-item" wx:if="{{item.location}}">
          <text class="meta-icon">ğŸ“</text>
          <text>{{item.location}}</text>
        </view>
      </view>
      <view class="team-footer">
        <view class="team-members">
          <text class="members-count">{{item.current_members}}/{{item.max_members}}</text>
          <text class="members-label">äºº</text>
        </view>
        <view class="team-fee">
          <text wx:if="{{item.fee_type === 'free'}}">å…è´¹</text>
          <text wx:elif="{{item.fee_type === 'AA'}}">AAå‡æ‘Š</text>
          <text wx:else>{{item.fee_amount}}é‡‘å¸/äºº</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && teams.length === 0}}">
    <text class="empty-text">æš‚æ— ç»„é˜Ÿï¼Œå¿«æ¥å‘èµ·ä¸€ä¸ªå§</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- å‘èµ·ç»„é˜ŸæŒ‰é’® -->
  <button class="btn-create" bindtap="createTeam">å‘èµ·ç»„é˜Ÿ</button>

  <!-- å‘èµ·ç»„é˜Ÿå¼¹çª— -->
  <view class="modal-mask" wx:if="{{showCreateModal}}" bindtap="closeModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">å‘èµ·ç»„é˜Ÿ</text>
        <view class="modal-close" bindtap="closeModal">Ã—</view>
      </view>

      <scroll-view class="modal-body" scroll-y>
        <!-- è¿åŠ¨ç±»å‹ -->
        <view class="form-item">
          <view class="form-label">è¿åŠ¨ç±»å‹</view>
          <picker mode="selector" range="{{sportTypeOptions}}" range-key="name" value="{{sportTypeIndex}}" bindchange="onSportTypeChange">
            <view class="form-picker">
              {{sportTypeOptions[sportTypeIndex].name}}
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>

        <!-- ç»„é˜Ÿæ ‡é¢˜ -->
        <view class="form-item">
          <view class="form-label">ç»„é˜Ÿæ ‡é¢˜ <text class="required">*</text></view>
          <input class="form-input" placeholder="å¦‚ï¼šå‘¨æœ«çº¦çƒ" value="{{formData.title}}" bindinput="onTitleInput" maxlength="50" />
        </view>

        <!-- æ´»åŠ¨æ—¥æœŸ -->
        <view class="form-item">
          <view class="form-label">æ´»åŠ¨æ—¥æœŸ <text class="required">*</text></view>
          <picker mode="date" start="{{minDate}}" value="{{formData.activity_date}}" bindchange="onDateChange">
            <view class="form-picker {{formData.activity_date ? '' : 'placeholder'}}">
              {{formData.activity_date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>

        <!-- æ´»åŠ¨æ—¶é—´ -->
        <view class="form-item">
          <view class="form-label">æ´»åŠ¨æ—¶é—´ <text class="required">*</text></view>
          <picker mode="time" value="{{formData.activity_time}}" bindchange="onTimeChange">
            <view class="form-picker {{formData.activity_time ? '' : 'placeholder'}}">
              {{formData.activity_time || 'è¯·é€‰æ‹©æ—¶é—´'}}
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>

        <!-- æ´»åŠ¨åœ°ç‚¹ -->
        <view class="form-item">
          <view class="form-label">æ´»åŠ¨åœ°ç‚¹</view>
          <input class="form-input" placeholder="å¦‚ï¼šXXè¿åŠ¨ä¸­å¿ƒ" value="{{formData.location}}" bindinput="onLocationInput" maxlength="100" />
        </view>

        <!-- æœ€å¤§äººæ•° -->
        <view class="form-item">
          <view class="form-label">æœ€å¤§äººæ•°</view>
          <picker mode="selector" range="{{maxMembersOptions}}" value="{{maxMembersIndex}}" bindchange="onMaxMembersChange">
            <view class="form-picker">
              {{maxMembersOptions[maxMembersIndex]}}äºº
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>

        <!-- è´¹ç”¨ç±»å‹ -->
        <view class="form-item">
          <view class="form-label">è´¹ç”¨è¯´æ˜</view>
          <picker mode="selector" range="{{feeTypeOptions}}" range-key="name" value="{{feeTypeIndex}}" bindchange="onFeeTypeChange">
            <view class="form-picker">
              {{feeTypeOptions[feeTypeIndex].name}}
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>

        <!-- è´¹ç”¨é‡‘é¢ï¼ˆå›ºå®šè´¹ç”¨æ—¶æ˜¾ç¤ºï¼‰ -->
        <view class="form-item" wx:if="{{formData.fee_type === 'fixed'}}">
          <view class="form-label">è´¹ç”¨é‡‘é¢ï¼ˆé‡‘å¸/äººï¼‰</view>
          <input class="form-input" type="number" placeholder="è¯·è¾“å…¥" value="{{formData.fee_amount}}" bindinput="onFeeInput" />
        </view>

        <!-- ç»„é˜Ÿæè¿° -->
        <view class="form-item">
          <view class="form-label">ç»„é˜Ÿæè¿°</view>
          <textarea class="form-textarea" placeholder="è¯´æ˜ä¸€ä¸‹æ´»åŠ¨è¯¦æƒ…ã€è¦æ±‚ç­‰" value="{{formData.description}}" bindinput="onDescInput" maxlength="500"></textarea>
        </view>
      </scroll-view>

      <view class="modal-footer">
        <button class="btn-cancel" bindtap="closeModal">å–æ¶ˆ</button>
        <button class="btn-submit" bindtap="submitCreate" loading="{{submitting}}" disabled="{{submitting}}">å‘èµ·</button>
      </view>
    </view>
  </view>
</view>
