<view class="container">
  <!-- å‘¨æœŸé€‰æ‹© -->
  <view class="period-tabs">
    <view
      wx:for="{{periodOptions}}"
      wx:key="value"
      class="period-tab {{periodType === item.value ? 'active' : ''}}"
      bindtap="onPeriodChange"
      data-period="{{item.value}}"
    >
      {{item.label}}
    </view>
  </view>

  <!-- åœºé¦†ç±»å‹ç­›é€‰ -->
  <view class="filter-bar" wx:if="{{venueTypes.length > 0}}">
    <picker mode="selector" range="{{venueTypes}}" range-key="name" bindchange="onVenueTypeChange">
      <view class="filter-picker">
        <text>{{venueTypes[venueTypeId ? venueTypes.findIndex(v => v.id === venueTypeId) : 0].name || 'ç»¼åˆ'}}</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>
  </view>

  <!-- æˆ‘çš„æ’åå¡ç‰‡ -->
  <view class="my-rank-card" wx:if="{{myRank}}">
    <view class="my-rank-left">
      <image class="my-avatar" src="{{myRank.avatar || '/assets/images/avatar-default.png'}}" mode="aspectFill"></image>
      <view class="my-info">
        <text class="my-name">{{myRank.nickname || 'æˆ‘'}}</text>
        <text class="my-stats">æ—¶é•¿ {{myRank.total_duration || 0}}åˆ†é’Ÿ Â· æ‰“å¡ {{myRank.check_count || 0}}æ¬¡</text>
      </view>
    </view>
    <view class="my-rank-right">
      <text class="my-rank-num" wx:if="{{myRank.rank}}">ç¬¬{{myRank.rank}}å</text>
      <text class="my-rank-num unranked" wx:else>æš‚æœªä¸Šæ¦œ</text>
    </view>
  </view>

  <!-- æ’è¡Œæ¦œåˆ—è¡¨ -->
  <view class="leaderboard-list">
    <view class="list-header">
      <text class="header-rank">æ’å</text>
      <text class="header-user">ç”¨æˆ·</text>
      <text class="header-duration">æ—¶é•¿</text>
      <text class="header-count">æ‰“å¡</text>
    </view>

    <view class="loading-tip" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <view class="empty-tip" wx:elif="{{leaderboard.length === 0}}">
      <image src="/assets/icons/empty.png" mode="aspectFit"></image>
      <text>æš‚æ— æ’è¡Œæ•°æ®</text>
    </view>

    <view
      wx:else
      wx:for="{{leaderboard}}"
      wx:key="member_id"
      class="rank-item"
    >
      <view class="rank-num {{item.rank <= 3 ? (item.rank === 1 ? 'gold' : item.rank === 2 ? 'silver' : 'bronze') : ''}}">
        <text wx:if="{{item.rank === 1}}" class="rank-medal">ğŸ¥‡</text>
        <text wx:elif="{{item.rank === 2}}" class="rank-medal">ğŸ¥ˆ</text>
        <text wx:elif="{{item.rank === 3}}" class="rank-medal">ğŸ¥‰</text>
        <text wx:else>{{item.rank}}</text>
      </view>

      <view class="user-info">
        <image class="user-avatar" src="{{item.avatar || '/assets/images/avatar-default.png'}}" mode="aspectFill"></image>
        <view class="user-detail">
          <text class="user-name">{{item.nickname || 'ç”¨æˆ·' + item.member_id}}</text>
          <view class="user-level" wx:if="{{item.level_name}}">
            <text>{{item.level_name}}</text>
          </view>
        </view>
      </view>

      <view class="duration-col">
        <text class="duration-value">{{item.total_duration}}</text>
        <text class="duration-unit">åˆ†é’Ÿ</text>
      </view>

      <view class="count-col">
        <text>{{item.check_count}}æ¬¡</text>
      </view>
    </view>
  </view>
</view>
